{"version":3,"file":"base.js","sources":["../../../../src/-private/external/task-instance/base.js"],"sourcesContent":["import { INITIAL_STATE } from './initial-state';\nimport { yieldableSymbol } from '../yieldables';\nimport { CancelRequest, CANCEL_KIND_EXPLICIT } from './cancelation';\nconst EXPLICIT_CANCEL_REASON = '.cancel() was explicitly called';\n\nexport class BaseTaskInstance {\n  constructor({ task, args, executor, performType, hasEnabledEvents }) {\n    this.task = task;\n    this.args = args;\n    this.performType = performType;\n    this.executor = executor;\n    this.executor.taskInstance = this;\n    this.hasEnabledEvents = hasEnabledEvents;\n  }\n\n  setState() {}\n  onStarted() {}\n  onSuccess() {}\n  onError() {}\n  onCancel() {}\n  formatCancelReason() {}\n  selfCancelLoopWarning() {}\n\n  onFinalize(callback) {\n    this.executor.onFinalize(callback);\n  }\n\n  proceed(index, yieldResumeType, value) {\n    this.executor.proceedChecked(index, yieldResumeType, value);\n  }\n\n  [yieldableSymbol](parentTaskInstance, resumeIndex) {\n    return this.executor.onYielded(parentTaskInstance, resumeIndex);\n  }\n\n  cancel(cancelReason = EXPLICIT_CANCEL_REASON) {\n    this.executor.cancel(new CancelRequest(CANCEL_KIND_EXPLICIT, cancelReason));\n  }\n\n  then(...args) {\n    return this.executor.promise().then(...args);\n  }\n\n  catch(...args) {\n    return this.executor.promise().catch(...args);\n  }\n\n  finally(...args) {\n    return this.executor.promise().finally(...args);\n  }\n\n  toString() {\n    return `${this.task} TaskInstance`;\n  }\n\n  start() {\n    this.executor.start();\n    return this;\n  }\n}\n\nObject.assign(BaseTaskInstance.prototype, INITIAL_STATE);\nObject.assign(BaseTaskInstance.prototype, {\n  state: 'waiting',\n  isDropped: false,\n  isRunning: true,\n});\n"],"names":["EXPLICIT_CANCEL_REASON","BaseTaskInstance","constructor","task","args","executor","performType","hasEnabledEvents","taskInstance","setState","onStarted","onSuccess","onError","onCancel","formatCancelReason","selfCancelLoopWarning","onFinalize","callback","proceed","index","yieldResumeType","value","proceedChecked","yieldableSymbol","parentTaskInstance","resumeIndex","onYielded","cancel","cancelReason","CancelRequest","CANCEL_KIND_EXPLICIT","then","promise","catch","finally","toString","start","Object","assign","prototype","INITIAL_STATE","state","isDropped","isRunning"],"mappings":";;;;AAGA,MAAMA,sBAAsB,GAAG,iCAAiC,CAAA;AAEzD,MAAMC,gBAAgB,CAAC;AAC5BC,EAAAA,WAAWA,CAAC;IAAEC,IAAI;IAAEC,IAAI;IAAEC,QAAQ;IAAEC,WAAW;AAAEC,IAAAA,gBAAAA;AAAiB,GAAC,EAAE;IACnE,IAAI,CAACJ,IAAI,GAAGA,IAAI,CAAA;IAChB,IAAI,CAACC,IAAI,GAAGA,IAAI,CAAA;IAChB,IAAI,CAACE,WAAW,GAAGA,WAAW,CAAA;IAC9B,IAAI,CAACD,QAAQ,GAAGA,QAAQ,CAAA;AACxB,IAAA,IAAI,CAACA,QAAQ,CAACG,YAAY,GAAG,IAAI,CAAA;IACjC,IAAI,CAACD,gBAAgB,GAAGA,gBAAgB,CAAA;AAC1C,GAAA;EAEAE,QAAQA,GAAG,EAAC;EACZC,SAASA,GAAG,EAAC;EACbC,SAASA,GAAG,EAAC;EACbC,OAAOA,GAAG,EAAC;EACXC,QAAQA,GAAG,EAAC;EACZC,kBAAkBA,GAAG,EAAC;EACtBC,qBAAqBA,GAAG,EAAC;EAEzBC,UAAUA,CAACC,QAAQ,EAAE;AACnB,IAAA,IAAI,CAACZ,QAAQ,CAACW,UAAU,CAACC,QAAQ,CAAC,CAAA;AACpC,GAAA;AAEAC,EAAAA,OAAOA,CAACC,KAAK,EAAEC,eAAe,EAAEC,KAAK,EAAE;IACrC,IAAI,CAAChB,QAAQ,CAACiB,cAAc,CAACH,KAAK,EAAEC,eAAe,EAAEC,KAAK,CAAC,CAAA;AAC7D,GAAA;AAEA,EAAA,CAACE,eAAe,CAAA,CAAEC,kBAAkB,EAAEC,WAAW,EAAE;IACjD,OAAO,IAAI,CAACpB,QAAQ,CAACqB,SAAS,CAACF,kBAAkB,EAAEC,WAAW,CAAC,CAAA;AACjE,GAAA;AAEAE,EAAAA,MAAMA,CAACC,YAAY,GAAG5B,sBAAsB,EAAE;AAC5C,IAAA,IAAI,CAACK,QAAQ,CAACsB,MAAM,CAAC,IAAIE,aAAa,CAACC,oBAAoB,EAAEF,YAAY,CAAC,CAAC,CAAA;AAC7E,GAAA;EAEAG,IAAIA,CAAC,GAAG3B,IAAI,EAAE;AACZ,IAAA,OAAO,IAAI,CAACC,QAAQ,CAAC2B,OAAO,EAAE,CAACD,IAAI,CAAC,GAAG3B,IAAI,CAAC,CAAA;AAC9C,GAAA;EAEA6B,KAAKA,CAAC,GAAG7B,IAAI,EAAE;AACb,IAAA,OAAO,IAAI,CAACC,QAAQ,CAAC2B,OAAO,EAAE,CAACC,KAAK,CAAC,GAAG7B,IAAI,CAAC,CAAA;AAC/C,GAAA;EAEA8B,OAAOA,CAAC,GAAG9B,IAAI,EAAE;AACf,IAAA,OAAO,IAAI,CAACC,QAAQ,CAAC2B,OAAO,EAAE,CAACE,OAAO,CAAC,GAAG9B,IAAI,CAAC,CAAA;AACjD,GAAA;AAEA+B,EAAAA,QAAQA,GAAG;AACT,IAAA,OAAQ,CAAE,EAAA,IAAI,CAAChC,IAAK,CAAc,aAAA,CAAA,CAAA;AACpC,GAAA;AAEAiC,EAAAA,KAAKA,GAAG;AACN,IAAA,IAAI,CAAC/B,QAAQ,CAAC+B,KAAK,EAAE,CAAA;AACrB,IAAA,OAAO,IAAI,CAAA;AACb,GAAA;AACF,CAAA;AAEAC,MAAM,CAACC,MAAM,CAACrC,gBAAgB,CAACsC,SAAS,EAAEC,aAAa,CAAC,CAAA;AACxDH,MAAM,CAACC,MAAM,CAACrC,gBAAgB,CAACsC,SAAS,EAAE;AACxCE,EAAAA,KAAK,EAAE,SAAS;AAChBC,EAAAA,SAAS,EAAE,KAAK;AAChBC,EAAAA,SAAS,EAAE,IAAA;AACb,CAAC,CAAC;;;;"}