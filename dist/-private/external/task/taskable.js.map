{"version":3,"file":"taskable.js","sources":["../../../../src/-private/external/task/taskable.js"],"sourcesContent":["import { DEFAULT_STATE } from './default-state';\nimport {\n  CancelRequest,\n  CANCEL_KIND_EXPLICIT,\n} from '../task-instance/cancelation';\n\nlet guidId = 0;\nfunction makeGuid() {\n  return `ec_${guidId++}`;\n}\n\nexport class Taskable {\n  constructor(options) {\n    this.context = options.context;\n    this.debug = options.debug || false;\n    this.enabledModifiers = options.enabledModifiers;\n    this.env = options.env;\n    this.group = options.group;\n    this.hasEnabledEvents = options.hasEnabledEvents;\n    this.modifierOptions = options.modifierOptions;\n    this.name = options.name;\n    this.onStateCallback = options.onStateCallback;\n    this.scheduler = options.scheduler;\n\n    this.guid = makeGuid();\n    this.guids = {};\n    this.guids[this.guid] = true;\n    if (this.group) {\n      Object.assign(this.guids, this.group.guids);\n    }\n  }\n\n  cancelAll(options) {\n    let { reason, cancelRequestKind, resetState } = options || {};\n    reason = reason || '.cancelAll() was explicitly called on the Task';\n\n    let cancelRequest = new CancelRequest(\n      cancelRequestKind || CANCEL_KIND_EXPLICIT,\n      reason,\n    );\n    return this.scheduler.cancelAll(this.guid, cancelRequest).then(() => {\n      if (resetState) {\n        this._resetState();\n      }\n    });\n  }\n\n  get _isAlive() {\n    return true;\n  }\n\n  _resetState() {\n    this.setState(DEFAULT_STATE);\n  }\n\n  // override\n  setState() {}\n}\n\nObject.assign(Taskable.prototype, DEFAULT_STATE);\nObject.assign(Taskable.prototype, {\n  numRunning: 0,\n  numQueued: 0,\n  isRunning: false,\n  isQueued: false,\n  isIdle: true,\n  state: 'idle',\n});\n"],"names":["guidId","makeGuid","Taskable","constructor","options","context","debug","enabledModifiers","env","group","hasEnabledEvents","modifierOptions","name","onStateCallback","scheduler","guid","guids","Object","assign","cancelAll","reason","cancelRequestKind","resetState","cancelRequest","CancelRequest","CANCEL_KIND_EXPLICIT","then","_resetState","_isAlive","setState","DEFAULT_STATE","prototype","numRunning","numQueued","isRunning","isQueued","isIdle","state"],"mappings":";;;AAMA,IAAIA,MAAM,GAAG,CAAC,CAAA;AACd,SAASC,QAAQA,GAAG;EAClB,OAAQ,CAAA,GAAA,EAAKD,MAAM,EAAG,CAAC,CAAA,CAAA;AACzB,CAAA;AAEO,MAAME,QAAQ,CAAC;EACpBC,WAAWA,CAACC,OAAO,EAAE;AACnB,IAAA,IAAI,CAACC,OAAO,GAAGD,OAAO,CAACC,OAAO,CAAA;AAC9B,IAAA,IAAI,CAACC,KAAK,GAAGF,OAAO,CAACE,KAAK,IAAI,KAAK,CAAA;AACnC,IAAA,IAAI,CAACC,gBAAgB,GAAGH,OAAO,CAACG,gBAAgB,CAAA;AAChD,IAAA,IAAI,CAACC,GAAG,GAAGJ,OAAO,CAACI,GAAG,CAAA;AACtB,IAAA,IAAI,CAACC,KAAK,GAAGL,OAAO,CAACK,KAAK,CAAA;AAC1B,IAAA,IAAI,CAACC,gBAAgB,GAAGN,OAAO,CAACM,gBAAgB,CAAA;AAChD,IAAA,IAAI,CAACC,eAAe,GAAGP,OAAO,CAACO,eAAe,CAAA;AAC9C,IAAA,IAAI,CAACC,IAAI,GAAGR,OAAO,CAACQ,IAAI,CAAA;AACxB,IAAA,IAAI,CAACC,eAAe,GAAGT,OAAO,CAACS,eAAe,CAAA;AAC9C,IAAA,IAAI,CAACC,SAAS,GAAGV,OAAO,CAACU,SAAS,CAAA;AAElC,IAAA,IAAI,CAACC,IAAI,GAAGd,QAAQ,EAAE,CAAA;AACtB,IAAA,IAAI,CAACe,KAAK,GAAG,EAAE,CAAA;IACf,IAAI,CAACA,KAAK,CAAC,IAAI,CAACD,IAAI,CAAC,GAAG,IAAI,CAAA;IAC5B,IAAI,IAAI,CAACN,KAAK,EAAE;AACdQ,MAAAA,MAAM,CAACC,MAAM,CAAC,IAAI,CAACF,KAAK,EAAE,IAAI,CAACP,KAAK,CAACO,KAAK,CAAC,CAAA;AAC7C,KAAA;AACF,GAAA;EAEAG,SAASA,CAACf,OAAO,EAAE;IACjB,IAAI;MAAEgB,MAAM;MAAEC,iBAAiB;AAAEC,MAAAA,UAAAA;AAAW,KAAC,GAAGlB,OAAO,IAAI,EAAE,CAAA;IAC7DgB,MAAM,GAAGA,MAAM,IAAI,gDAAgD,CAAA;IAEnE,IAAIG,aAAa,GAAG,IAAIC,aAAa,CACnCH,iBAAiB,IAAII,oBAAoB,EACzCL,MACF,CAAC,CAAA;AACD,IAAA,OAAO,IAAI,CAACN,SAAS,CAACK,SAAS,CAAC,IAAI,CAACJ,IAAI,EAAEQ,aAAa,CAAC,CAACG,IAAI,CAAC,MAAM;AACnE,MAAA,IAAIJ,UAAU,EAAE;QACd,IAAI,CAACK,WAAW,EAAE,CAAA;AACpB,OAAA;AACF,KAAC,CAAC,CAAA;AACJ,GAAA;EAEA,IAAIC,QAAQA,GAAG;AACb,IAAA,OAAO,IAAI,CAAA;AACb,GAAA;AAEAD,EAAAA,WAAWA,GAAG;AACZ,IAAA,IAAI,CAACE,QAAQ,CAACC,aAAa,CAAC,CAAA;AAC9B,GAAA;;AAEA;EACAD,QAAQA,GAAG,EAAC;AACd,CAAA;AAEAZ,MAAM,CAACC,MAAM,CAAChB,QAAQ,CAAC6B,SAAS,EAAED,aAAa,CAAC,CAAA;AAChDb,MAAM,CAACC,MAAM,CAAChB,QAAQ,CAAC6B,SAAS,EAAE;AAChCC,EAAAA,UAAU,EAAE,CAAC;AACbC,EAAAA,SAAS,EAAE,CAAC;AACZC,EAAAA,SAAS,EAAE,KAAK;AAChBC,EAAAA,QAAQ,EAAE,KAAK;AACfC,EAAAA,MAAM,EAAE,IAAI;AACZC,EAAAA,KAAK,EAAE,MAAA;AACT,CAAC,CAAC;;;;"}